{% comment %}
  Quick Add Popup Section for Horizon theme
  Dynamically loaded via Section Rendering API
{% endcomment %}

<quick-add-popup id="QuickAddPopup" class="quick-add-popup hidden" role="dialog" aria-modal="true">
  <div class="popup-overlay"></div>
  <div class="popup-content">
    <button class="popup-close" aria-label="Close">
      {{- 'icon-close.svg' | inline_asset_content -}}
    </button>
    <div id="QuickAddPopupContent" class="quick-add-popup__content">
        <h2>{{ product.title }}</h2>
        {%unless product.has_only_default_variant %}
        <div class="variants-container">
          {% assign option_count = product.options_with_values.size %}

          {% for option in product.options_with_values %}
            <fieldset>
              <legend>{{ option.name }}</legend>
              <div class="quick-add_product-variant-details">
                {% for value in option.values %}
                  {% assign matched_variant = nil %}

                  {%- for variant in product.variants -%}
                    {%- assign match = true -%}

                    {%- for opt in product.options_with_values -%}
                      {%- assign opt_pos = 'option' | append: opt.position -%}

                      {%- if opt.name == option.name -%}
                        {%- if variant[opt_pos] != value -%}
                          {%- assign match = false -%}
                        {%- endif -%}
                      {%- else -%}
                        {%- if opt.selected_value and variant[opt_pos] != opt.selected_value -%}
                          {%- assign match = false -%}
                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}

                    {%- if match -%}
                      {% assign matched_variant = variant %}
                      {% break %}
                    {%- endif -%}
                  {%- endfor -%}

                  {% if matched_variant %}
                    <input 
                      class="variant-select-input" 
                      value="{{ matched_variant.id }}" 
                      type="radio" 
                      name="{{ option.name }}" 
                      id="{{ option.name }}-{{ value | handle }}" 
                      {% if option.selected_value == value %}checked{% endif %}
                    >

                    <label for="{{ option.name }}-{{ value | handle }}">
                      <div class="product_variant_item">
                        <div class="product_variant-image">
                          <img 
                            src="{{ matched_variant.featured_image | default: product.featured_image | image_url: width: 200 }}" 
                            width="" 
                            height="" 
                            alt="{{ matched_variant.title | escape }}"
                          >
                        </div>

                        <div class="product_variant-title">
                          <p>{{ product.title }}</p>
                          <p class="product_variant-name">{{ value }}</p>
                        </div>

                        <div class="product_variant-price-container">
                          <div class="product_variant-price">
                            <span class="product-price">{{ matched_variant.price | money }}</span>

                            {% if matched_variant.compare_at_price > matched_variant.price %}
                              <span class="product-compare-price">{{ matched_variant.compare_at_price | money }}</span>
                            {% endif %}
                          </div>

                          {% if matched_variant.unit_price_measurement %}
                            <div class="product_variant-details">
                              <span>
                                {{ matched_variant.unit_price | money }}/{{ matched_variant.unit_price_measurement.reference_unit }}
                              </span>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    </label>
                  {% endif %}
                {% endfor %}
              </div>
            </fieldset>
          {% endfor %}
        </div>

        {% endunless %}
      
      {% content_for 'block', type: 'variant-picker', id: 'variant-picker' %}
      {% if product %}
         {% content_for 'block', type: 'buy-buttons', id: 'buyButton' %}
      {% else %}
        <p>Loading product information...</p>
      {% endif %}
    </div>
  </div>
</quick-add-popup>

<style>
.quick-add-popup {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.quick-add-popup.hidden { display: none; }
.popup-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
}
.popup-content {
  position: relative;
  background: #fff;
  max-width: 600px;
  width: 90%;
  padding: 24px;
  border-radius: 12px;
  z-index: 2;
}
.popup-close {
  position: absolute;
    top: -40px;
    right: -40px;
    border: none;
    cursor: pointer;
    width: 44px;
    height: 44px;
    background: #D9D9D9;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 200px;
    color: #E90000;
}
.quick-add_product-variant-details {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 10px;
}
.quick-add-popup__content fieldset{
  border: none;
  padding: 0;
}
.variants-container{
  margin-bottom: 15px;
}
.variant-select-input{
  display: none;
}
.quick-add_product-variant-details label{
  cursor: pointer;
}
.variant-select-input:checked+label{
  border: 1px solid #ed1d23;
  border-radius: 7px;
}
.quick-add-popup__content h2{
  font-weight: 700;
  font-size: 24px;
  line-height: 28px;
}
.product_variant_item{
            display: flex;
            gap: 20px;
            background-color:  #fee9e9;
            border-radius: 8px;
            padding: 18px 22px;
        }
        .product_variant-image img{
            width: 77px;
            border-radius: 7px;;
        }
        .product_variant-title{
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .product-compare-price{
            text-decoration: line-through;
            color: #7F7474;
            font-weight: 600;
            font-size: 14px;
            line-height: 19.6px;
        }
        .product_variant-title p{
            font-weight: 500;
            font-size: 18px;
            line-height: 25.2px;
            margin: 0;
        }
        p.product_variant-name{
          font-weight: 700;
          font-size: 18px;
          line-height: 25.2px;
        }
        .product_variant-price{
          display: flex;
          align-items: center;
          gap: 24px;
        }
        .product_variant-price .product-price{
          font-weight: 600;
          font-size: 20px;
          line-height: 30px;
        }
        .product_variant-details span{
          font-weight: 600;
          font-size: 14px;
          line-height: 19.6px;
        }
        .product_variant-price-container{
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
</style>
