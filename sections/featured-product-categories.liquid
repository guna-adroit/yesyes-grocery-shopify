{% comment %}
  Popular Products Section
  Displays up to 6 collections, each with customizable number of products.
  Mobile: slider layout
  Desktop: grid layout
{% endcomment %}

<section id="popular-products" class="popular-products-section color-{{ section.settings.color_scheme }}">
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="section-heading text-center">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="collections-wrapper">
      {% for block in section.blocks %}
        {% assign collection = block.settings.collection %}
        {% if collection != blank %}
          <div class="collection-group" {{ block.shopify_attributes }}>
            {% if block.settings.title != blank %}
              <h3 class="collection-title">{{ block.settings.title }}</h3>
            {% else %}
              <h3 class="collection-title">{{ collection.title }}</h3>
            {% endif %}

            <div class="products-grid" data-slider>
              {% for product in collection.products limit: section.settings.products_to_show %}
                {% capture children %}
                  <div class="featured-product-content-top">
                    <h4 class="product-title">{{ product.title }}</h4>
                    <div class="product-price">{{ product.price | money }}</div>
                  </div>

                  {% if product.featured_media %}
                    <div class="featured-product-gallery">
                      <img
                        src="{{ product.featured_media | image_url: width: 400 }}"
                        alt="{{ product.featured_media.alt | escape }}"
                        loading="lazy"
                      >
                    </div>
                  {% endif %}
                {% endcapture %}

                {% render 'product-card', product: product, children: children, product_card_gap: 8 %}
              {% endfor %}
            </div>

            {% if block.settings.show_view_all %}
              <div class="view-all-wrap">
                <a href="{{ collection.url }}" class="button view-all-button">
                  {{ block.settings.view_all_label | default: 'View all' }}
                </a>
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

{% stylesheet %}
.popular-products-section {
  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
}

.collections-wrapper {
  display: grid;
  gap: 40px;
}

.collection-group {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.view-all-wrap {
  text-align: center;
  margin-top: 10px;
}

.view-all-button {
  display: inline-block;
  padding: 10px 20px;
  border: 1px solid currentColor;
  text-decoration: none;
  border-radius: 5px;
}

@media screen and (max-width: 749px) {
  .products-grid {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    scroll-snap-type: x mandatory;
  }
  .products-grid > * {
    flex: 0 0 70%;
    scroll-snap-align: start;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Popular Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section heading",
      "default": "Popular Products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Number of products to show per collection",
      "min": 1,
      "max": 12,
      "default": 4
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select collection"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Custom title (optional)"
        },
        {
          "type": "checkbox",
          "id": "show_view_all",
          "label": "Show 'View all' button",
          "default": true
        },
        {
          "type": "text",
          "id": "view_all_label",
          "label": "Button label",
          "default": "View all"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Popular Products",
      "category": "Products",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}
