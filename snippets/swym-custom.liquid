<script>
function onSwymLoadCallback(swat) {
  function handleSwymCartUpdate(eventData) {
    // Dispatch the same event your theme uses when adding to cart
    const itemCount = eventData?.quantity || 1;
    const productId = eventData?.productId || '';
    const variantId = eventData?.variantId || '';

    document.dispatchEvent(
      new CustomEvent('CartAddEvent', {
        detail: {
          id: variantId.toString(),
          source: 'swym',
          itemCount,
          productId,
        },
        bubbles: true,
        cancelable: true,
      })
    );

    // Optionally trigger any other theme-specific cart refresh logic
    // E.g., quantity boxes, header cart counter, etc.
    const cartSections = document.querySelectorAll('cart-items-component');
    cartSections.forEach((section) => {
      section.dispatchEvent(
        new CustomEvent('cart:update', { detail: { itemCount, productId } })
      );
    });
  }

  swat.evtLayer.addEventListener(swat.JSEvents.UIAddedToCart, function(evt) {
    handleSwymCartUpdate(evt.detail);
  });

  swat.evtLayer.addEventListener(swat.JSEvents.UIAddedAllToCart, function(evt) {
    handleSwymCartUpdate(evt.detail);
  });
}

if (!window.SwymCallbacks) {
  window.SwymCallbacks = [];
}
window.SwymCallbacks.push(onSwymLoadCallback);
</script>
